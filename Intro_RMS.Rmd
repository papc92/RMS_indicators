---
title: |
    ![](LOGO_unhcr.png){width=5in}
    
    <span style="color:#0072BC">
    RMS Ecuador - Quantitative Results
    </span>
output:
  html_document:
    unhcRstyle::unhcr_templ_html:
    toc: true
    toc_depth: 3
    number_sections: false
    toc_float:
      collapsed: false
      smooth_scroll: false
date: "`r format(Sys.time(), '%d %B %Y')`"
---

<style type="text/css">
  body{
  font-size: 14pt;
}
</style>

```{css, echo=FALSE}
  #TOC {
    max-width: fit-content;
    white-space: nowrap;
  }
  
  div:has(> #TOC) {
    display: flex;
    flex-direction: row-reverse;
}
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	fig.align = "center",
	fig.height = 6,
	fig.width = 8,
	message = FALSE,
	warning = FALSE,
	collapse = FALSE,
	comment = "#>"
)
knitr::opts_chunk$set(fig.width = 8, fig.height = 6)
set.seed(1)
extrafont::loadfonts(quiet=TRUE)
options(scipen = 999) # turn-off scientific notation like 1e+48

```

```{r data, include=FALSE}
library(readr)
library(readxl)
library(dplyr)
library(ggplot2)
library(knitr)
library(tidyr)
library(forcats)
library(haven)
#library(tidyverse)
library(srvyr)
library(labelled)
#library(dm)
library(kableExtra)
#library(unhcRstyle)
library(survey)
library(questionr)
library(xlsx)

hh <- read_excel("C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/RMS_Ecuador_-_Septiembre_2022_-_all_versions_-_False_-_2022-11-13-20-57-33.xlsx", sheet = "RMS Ecuador - Septiembre 2022")

hh <- hh %>% 
  select(-c("start",	"end",	"date1",	"apellidos_jefe",	"nombres_jefe",	"seguimiento", "date2",	
                 "date3",	"num_NNA")) %>% 
  filter(Intro03 == 1)

roster1 <- read_excel("C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/RMS_Ecuador_-_Septiembre_2022_-_all_versions_-_False_-_2022-11-13-20-57-33.xlsx", sheet = "S1")

roster2 <- read_excel("C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/RMS_Ecuador_-_Septiembre_2022_-_all_versions_-_False_-_2022-11-13-20-57-33.xlsx", sheet = "S2")

educ1 <- read_excel("C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/RMS_Ecuador_-_Septiembre_2022_-_all_versions_-_False_-_2022-11-13-20-57-33.xlsx", sheet = "P2.S3")

educ2 <- read_excel("C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/RMS_Ecuador_-_Septiembre_2022_-_all_versions_-_False_-_2022-11-13-20-57-33.xlsx", sheet = "P2.S4")

weights <- read_dta("C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/rms_weights.dta")

weights_ind <- read_dta("C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/rms_ind_weights.dta")

```

```{r merge_data, include=FALSE}
roster1 <- roster1 %>% 
  select(-c("_parent_table_name", "_submission__uuid",	"_submission__submission_time", "_submission__validation_status",	"_submission__notes",	"_submission__status",	"_submission__submitted_by", "_submission__tags"))

roster2 <- roster2 %>% 
  select(-c("_parent_table_name", "_submission__uuid",	"_submission__submission_time", "_submission__validation_status",	"_submission__notes",	"_submission__status",	"_submission__submitted_by", "_submission__tags"))

educ1 <- educ1 %>% 
  select(-c("_parent_table_name", "_submission__uuid",	"_submission__submission_time", "_submission__validation_status",	"_submission__notes",	"_submission__status",	"_submission__submitted_by", "_submission__tags"))

educ2 <- educ2 %>% 
  select(-c("_parent_table_name", "_submission__uuid",	"_submission__submission_time", "_submission__validation_status",	"_submission__notes",	"_submission__status",	"_submission__submitted_by", "_submission__tags"))

data_per <- cbind.data.frame(roster1, roster2, educ1, educ2, by = c("_index", "_submission__id"), all.y = TRUE)

data_per <- data_per %>% 
  select(-c(8, 9, 10, 140, 141, 142, 161, 162, 163))

joined_data <- hh %>% 
  full_join(data_per, by = c("_id" = "_submission__id"), keep = TRUE)

joined_data <- joined_data %>%
  filter(Intro03 == 1)

```

```{r merge_ind, include=FALSE}
# glimpse(df$hh)
# glimpse(df$roster1)
# glimpse(df$roster2)
# glimpse(df$educ1)
# glimpse(df$educ2)

#### get dimensions of datasets above

dim(hh)
dim(roster1)
dim(roster2)
dim(educ1)
dim(educ2)

### merge all individual datasets 

ind_merge <- merge(roster1,roster2, by=c("_index","_parent_index"))
ind_ <- merge(ind_merge,educ1, by=c("_index","_parent_index"))
ind <- merge(ind_,educ2, by=c("_index","_parent_index"))

ind <- ind[, !duplicated(colnames(ind), fromLast = TRUE)]

###Removed unused datasets

rm(ind_merge)
rm(ind_)

```

```{r citizenship}
ind$REF02 <- ordered(ind$REF02, levels= c(1,2,3,96),
                     labels = c('Colombiana', 'Venezolana',
                                'Ecuatoriana', 'Otra'))

```

```{r age_disaggregations}
###Calculate age groups for disaggregation for ind and main dataset

ind$HH07_cat <- cut(ind$HH07, 
                    breaks = c(-1, 4, 17, 59, Inf),
                    labels = c("0-4", "5-17", "18-59", "60+"))
```

```{r disability_disaggregations}
### Disability for disaggregation ind dataset
####Calculated based on WG suggestions : https://www.washingtongroup-disability.com/fileadmin/uploads/wg/Documents/WG_Document__5C_-_Analytic_Guidelines_for_the_WG-SS__Stata_.pdf

##Step.1 Create variable for calculating disability 

ind <-  ind %>%
  mutate( # disability identifier variables according to Washington Group standards
    disaux1_234 = DIS01 %in% c("2","3","4"), # indicator variables for all 6 domains with value TRUE if SOME DIFFICULTY or A LOT OF DIFFICULTY or CANNOT DO AT ALL
    disaux2_234 = DIS02 %in% c("2","3","4"),
    disaux3_234 = DIS03 %in% c("2","3","4"),
    disaux4_234 = DIS04 %in% c("2","3","4"),
    disaux5_234 = DIS05 %in% c("2","3","4"),
    disaux6_234 = DIS06 %in% c("2","3","4"),
    
    disaux1_34 = DIS01 %in% c("3","4"), # indicator variables for all 6 domains with value TRUE if A LOT OF DIFFICULTY or CANNOT DO AT ALL
    disaux2_34 = DIS02 %in% c("3","4"),
    disaux3_34 = DIS03 %in% c("3","4"),
    disaux4_34 = DIS04 %in% c("3","4"),
    disaux5_34 = DIS05 %in% c("3","4"),
    disaux6_34 = DIS06 %in% c("3","4")
  ) %>%
  mutate(
    disSum234 = rowSums(select(., disaux1_234, disaux2_234 , disaux3_234 , disaux4_234 , disaux5_234 , disaux6_234)), # count number of TRUE indicator variables over 6 domains
    disSum34 = rowSums(select(., disaux1_34, disaux2_34 , disaux3_34 , disaux4_34 , disaux5_34 , disaux6_34)) # count number of TRUE indicator variables over 6 domains
    ) %>%
  mutate(
    DISABILITY1 = case_when( # : the level of inclusion is at least one domain/question is coded SOME DIFFICULTY or A LOT OF DIFFICULTY or CANNOT DO AT ALL.
      disSum234 >= 1 ~ 1,
      disSum234 == 0 & (!(DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99"))) ~ 0,
      DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99") ~ 98
    )
  ) %>%
  mutate(
    DISABILITY2 = case_when( # : the level of inclusion is at least two domains/questions are coded SOME DIFFICULTY or A LOT OF DIFFICULTY or CANNOT DO AT ALL or any 1 domain/question is coded A LOT OF DIFFICULTY or CANNOT DO AT ALL
      disSum234 >= 2 | disSum34 >=1  ~ 1,
      disSum234 < 2 & disSum34 == 0 & (!(DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99"))) ~ 0,
      DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99") ~ 98
    )
  ) %>%
  mutate(
    DISABILITY3 = case_when( # : the level of inclusion is at least one domain/question is coded A LOT OF DIFFICULTY or CANNOT DO AT ALL.
      disSum34 >= 1 ~ 1,
      disSum34 == 0 & (!(DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99"))) ~ 0,
      DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99") ~ 98
    )
  ) %>%
  mutate(
    DISABILITY4 = case_when( # : the level of inclusion is at least one domain/question is coded CANNOT DO AT ALL.
      DIS01=="4" | DIS02=="4" | DIS03=="4" | DIS04=="4" | DIS05=="4" | DIS06=="4" ~ 1,
      !(DIS01=="4" | DIS02=="4" | DIS03=="4" | DIS04=="4" | DIS05=="4" | DIS06=="4") & (!(DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99"))) ~ 0,
      DIS01 %in% c("98","99") & DIS02 %in% c("98","99") & DIS03 %in% c("98","99") & DIS04 %in% c("98","99") & DIS05 %in% c("98","99") & DIS06 %in% c("98","99") ~ 98
    )
  ) %>%
  mutate(
    DISABILITY1 = labelled(DISABILITY1,
                           labels = c(
                             "Without disability" = 0,
                             "With disability" = 1,
                             "Unknown" = 98
                           ),
                           label = "Washington Group disability identifier 1"),
    DISABILITY2 = labelled(DISABILITY2,
                           labels = c(
                             "Without disability" = 0,
                             "With disability" = 1,
                             "Unknown" = 98
                           ),
                           label = "Washington Group disability identifier 2"),
    DISABILITY3 = labelled(DISABILITY3,
                           labels = c(
                             "Without disability" = 0,
                             "With disability" = 1,
                             "Unknown" = 98
                           ),
                           label = "Washington Group disability identifier 3"),
    DISABILITY4 = labelled(DISABILITY4,
                           labels = c(
                             "Without disability" = 0,
                             "With disability" = 1,
                             "Unknown" = 98
                           ),
                           label = "Washington Group disability identifier 4"))
###Calculate having at least one disability identifier among 4 categories 
ind <- ind %>%
  mutate(disab=
           case_when(DISABILITY1==1 | DISABILITY2==1 | DISABILITY3==1 | DISABILITY4==1 ~ 1, 
                               DISABILITY1==0 | DISABILITY2==0 | DISABILITY3==0 | DISABILITY4==0 ~ 0,
                               TRUE ~ NA_real_)
   ) %>%
  mutate(disab = labelled(disab,
                           labels = c(
                             "Without disability" = 0,
                             "With disability" = 1)
                           ))
```

```{r merging_disaggregation in hh}

###Create similar variable names for merging with the individual dataset
hh$"_parent_index" <- hh$"_index"


##Select indicators for merge
ind_m <- ind %>%
  select("_parent_index", "HH07_cat", "disab", "REF02","HH02", "HH07", "HH04") ##ADD VARIABLES FOR MERGING

#ind <- ind %>% 
#  select(-c(10, 140))
# --> to get the individual variables in the hh dataframe
ind$hhnumb <- ind$'_parent_index'
ind$penumb <- ind$'_index' 
  
ind_pr <- ind %>% 
  group_by(hhnumb) %>% 
  slice_min(penumb, n=1)

main <-
  left_join(hh,
            ind_pr %>% dplyr::select("_parent_index", "HH02", "HH07"),
            by = "_parent_index")

main <- merge(ind_m, main, by=c("HH02", "HH07", "_parent_index"))

rm(ind_m)


```

```{r review col_dup in ind}
## Import HH level variables from individual dataset
# >>NO! ind <- main %>%
#       full_join(ind, by = c("_id" = "_submission__id.y"), keep = TRUE)

### Household head in main dataset is HH07 for age and HH04 for gender

main$HH07_cat <- cut(main$HH07, 
                     breaks = c(-1, 4, 17, 59, Inf),
                     labels = c("0-4", "5-17", "18-59", "60+"))

ind <- ind[, !duplicated(colnames(ind), fromLast = TRUE)]

```

```{r including-weights-in-data, include=FALSE}

ind <- merge(ind, weights_ind, by=c("_parent_index", "_index"), all=FALSE)

main <- merge(main, weights, by="_index", all=FALSE)

main <- main %>% filter(!is.na(weights))
ind <- ind %>% filter(!is.na(w_roster))

main <- main %>% 
  rename(REF02 = REF02.y) %>% 
  rename(HH04 = HH04.y) %>% 
  rename(nw_natio = REF02.x) %>% 
  rename(nw_sex = HH04.x)

# main <- main %>% mutate(REF02 = case_when(
#   Intro02_1=="797-00645819" ~ "Colombiana")) 
# 
# main <- main %>% mutate(REF02 = case_when(
#   Intro02_1=="797-00604495" ~ "Colombiana"))
# 
# main <- main %>% mutate(REF02 = case_when(
#   REF02=="Ecuatoriana" ~ "Venezolana"))
```

```{r defining svy design}
svy.dat <- svydesign(ids=~1, data=main, weights=main$weights)

svy.ind <- svydesign(ids=~1, data=ind, weights=ind$w_roster)

#svytable(~main$outcome16_2, design=svy.dat) %>% prop.table()

#svytable(~ind$outcome1_2, design=svy.ind) %>% prop.table()

#main %>% group_by(REF02) %>% summarise(weighted.mean(impact3_3, weights, na.rm=TRUE))

```


# <span style="color:#0072BC">**Introduction**</span>

The following report will present the main results of the Results Monitoring Survey (RMS) of Ecuador aiming to provide a baseline for the impact and outcome indicators of the multi-year strategy of UNHCR.

Ecuador was selected in 2022 to be one of country pilot of the Americas region. 

The RMS in Ecuador has some specificities:

1. In Ecuador, the RMS is a phone survey outsourced to a local company. The questionnaire was first adapted that a key informant can answer all specific questions on behalf of any member of the household roster by phone. This methodology was first tested in February 2022 with a reduced number of respondents and proved efficient from a technical and financial standpoint. Due to these promising results, the Ecuador team decided, thanks to a special funding from HQ, to increase the number of respondents to get more "operational" data while comparing the impact and outcome indicators by region to develop the most relevant projects.
2. The average survey time is 35 minutes, 5 extra-minutes might be necessary for household with more than 5 members.
3. ProGres V4 is the sampling frame for the RMS survey. In order to mitigate outdated phone numbers (as it was detected in other phone surveys in 2021), it was decided to use only individual registered from 2019.
4. The sampling unit is the individual. The sampling strategy includes 12 domains of study with the combination of:
    + Two domains of study by nationality: Colombian and Venezuelan
    + Three areas of coverage by each sub-unit in the field: North, Central, and South
    + Two different age-based sampling frames: adults (15+ years), and children (<15 years) to get data for specific indicators
5. The Ecuador RMS data is synchronized with RIDL: https://ridl.unhcr.org/dataset/rms-ecuador-septiembre-2022
6. In Ecuador, RMS has been merged with Protection Monitoring Tool (PMT) to reduce overall costs of two distinct surveys while avoiding survey fatigue.


# <span style="color:#0072BC">**RMS / Protection Monitoring**</span>

In this section, we are highlighting some results that can be interchangeably used for Protection Monitoring or RMS reports such as region of residence, average size of the household and displacement intentions. 

## Province and region of residence:

```{r province}
main <- main %>% mutate(prov_ = case_when(
                  (PROVINCE==98 & city_other=="AZOGUES") |
                  (PROVINCE==98 & city_other=="AZOGUEZ") |
                  (PROVINCE==98 & city_other=="CAÑAR") |
                  (PROVINCE==98 & city_other=="CAÑAR / AZOGUES / 4 ESQUINAS") |
                  (PROVINCE==98 & city_other=="CAÑAR INGAPIRCA") |
                  (PROVINCE==98 & city_other=="LA TRONCAL") ~ "CAÑAR",
                  (PROVINCE==98 & city_other=="MORONA SANTIAGO") |
                  (PROVINCE==98 & city_other=="MORONA,SANTIAGO, BARRIO LA FLORIDA") ~
                    "MORONA SANTIAGO",
                  (PROVINCE==98 & city_other=="NAPO") |
                  (PROVINCE==98 & city_other=="NAPO,EL TENA, BARRIO AEROPUERTO 2") ~
                    "NAPO",
                  (PROVINCE==98 & city_other=="Puyo") ~ "PASTAZA",
                  TRUE ~ prov_)) 

Prov <- main %>% mutate(id_row = row_number()) %>% mutate(ones = 1) %>%
  group_by(prov_) %>%
  summarise(sum(ones)) %>%
  rename(vals = 'sum(ones)')

ggplot(Prov, aes(x=reorder(prov_, vals), y=vals)) +
    geom_bar(stat="identity", fill="#0072bc", alpha=.6, width=.9) +
    geom_text(aes(label=vals), position = position_dodge(width=0.9), 
              vjust=0.25, size=3) +
    coord_flip() +
    xlab("") +
    ggtitle("Number of surveys by province of residence") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x = element_blank(),
          axis.title.x = element_blank(),
          axis.ticks.x = element_blank(),
          plot.title = element_text(face="bold", size=12, hjust=0.5))

```

As highlighted in the figure above, Pichincha and Guayas are the provinces where most of the respondents are currently residing. It should be noted that Manabí is out of the top-5 due to limitations of proGres V4 database (compared to Pichincha and Guayas provinces, registration activities did start later in Manabí).

```{r creating_regions}

main$region <- as.numeric(ifelse(main$prov_ == 'ESMERALDAS' | main$prov_ ==  'CARCHI' 
                               | main$prov_ ==  'IMBABURA' | main$prov_ ==  'SUCUMBÍOS' 
                               | main$prov_ ==  'ORELLANA', 1,
                       ifelse(main$prov_ == 'PICHINCHA' 
                              | main$prov_ == 'SANTO DOMINGO DE LOS TSÁCHILAS' 
                              | main$prov_ ==  'COTOPAXI' | main$prov_ ==  'CHIMBORAZO' 
                              | main$prov_ ==  'TUNGURAHUA' | main$prov_ == 'NAPO' 
                              | main$prov_ == 'PASTAZA', 2, 
                       ifelse(main$prov_ == 'MANABÍ' | main$prov_ == 'LOS RÍOS' 
                              | main$prov_ == 'GUAYAS' 
                              | main$prov_ == 'SANTA ELENA' | main$prov_ == 'EL ORO' 
                              | main$prov_ == 'AZUAY' | main$prov_ == 'LOJA' 
                              | main$prov_ == 'ZAMORA CHINCHIPE' 
                              | main$prov_ == 'MORONA SANTIAGO'
                              | main$prov_ == 'CAÑAR', 3, 98))))

main$region <- ordered(main$region, levels= c(1,2,3),
                     labels = c('North', 'Center', 'South'))
  
#hh$region[] <-  lapply(hh$region, as.character)

region <- (as.data.frame(wtd.table(main$region, weights=main$weights))) %>%  
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1))

region2 <- main %>% mutate(id_row = row_number()) %>% mutate(ones = 1) %>%
  group_by(region) %>%
  summarise(sum(ones)) %>%
  rename(vals = 'sum(ones)') %>% 
  mutate(Percent=100*vals/sum(vals)) %>% 
          mutate(Percent=round(Percent, 1))

ggplot(region2, aes(x=reorder(region, Percent), y=Percent)) +
    geom_bar(stat="identity", fill="#0072bc", alpha=.4, width=.6) +
    geom_text(aes(label=Percent), position = position_dodge(width=0.9), 
              vjust=0.25, size=4) +
    coord_flip() +
    xlab("") +
    ggtitle("Percentage of surveys by region") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x = element_blank(),
          axis.title.x = element_blank(),
          axis.ticks.x = element_blank(),
          axis.text.y = element_text(size=14),
          plot.title = element_text(face="bold", size=14, hjust=0.5))

```

Finally, the RMS collected surveys balanced between the Center and Southern coverage regions, with a lower extent in the Northern region.

## Average size of household:

```{r hh_size}

#geom_boxplot(outlier.colour = "red", outlier.shape = 8, outlier.size = 4, notch = FALSE)

stat_box_data <- function(y, upper_limit = max(iris$Sepal.Length) * 1.15) {
  return(
    data.frame(
      y = 0.95 * upper_limit,
      label = paste('mean =', round(mean(y), 2), '\n')
    )
  )
}

#'count =', length(y), '\n',

aux <- main %>% group_by(region) %>% summarise(we=sum(weights),
                                                tsize=sum(HH01*weights)) %>% 
        mutate(hsize=round(tsize/we,1)) 


ggplot(main, aes(x=HH01, y=region)) +
  geom_boxplot() + coord_flip() +
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5, 
               vjust = 1.3, size=4) +
  stat_summary(fun = "mean", geom="point", shape=20, size=8, color="#0072bc", fill="#0072bc") +
  theme(panel.background = element_rect(fill="white"),
          axis.text=element_text(size=10),
        axis.title=element_text(size=10,face="bold"))

```

The average size of household is 3.8 for Center and South regions, and 3.7 for North. This is a consistent result with other surveys done in Ecuador.


```{r spn, include=FALSE}
## Special Needs

spn <- hh %>%
  filter(Intro03 == 1) %>% 
  select("SPNEEDS.1",	"SPNEEDS.2",	"SPNEEDS.3",	"SPNEEDS.4",	"SPNEEDS.5",	"SPNEEDS.6",	
         "SPNEEDS.7",	"SPNEEDS.8") %>%
  summarise(across(SPNEEDS.1:SPNEEDS.8, sum)) 

spn <- spn %>%
  rename('Medical condition without treatment' = SPNEEDS.1,	
         'Medical condition with treatment' = SPNEEDS.2,	
         'Unnacompanied children' = SPNEEDS.3,	
         'Pregnant women' = SPNEEDS.4,	
         'Lactating woman' = SPNEEDS.5,	
         'Mother/Father alone with kids' = SPNEEDS.6,	
         'Violence victim or survivor' = SPNEEDS.7,	
         'None of this needs' = SPNEEDS.8
         )


spn2 <- gather(spn, v, val, "Medical condition without treatment":"None of this needs")


ggplot(spn2, aes(x=reorder(v, val), y=val)) +
    geom_bar(stat="identity", fill="#0072bc", alpha=.6, widht=.4) +
    coord_flip() +
    xlab("") + 
    theme(panel.background = element_rect(fill="white"),
          axis.text=element_text(size=14),
        axis.title=element_text(size=14,face="bold"))

#Given the last figure and as we saw in HFS during 2021, the main special need reported by PoC surveyed corresponds to _Violence victim or survivor_. It is interesting also that mothers or fathers alone with kids is the second special need.

```


## Displacement Intentions

```{r displacement, include=FALSE}
d_int <- main %>%
  select("DISPL_INTENTIONS", "DISPL_WHERE", region, weights) %>%
  mutate(DISPL_INTENTIONS = recode(DISPL_INTENTIONS,
                      '0'="No",
                      '1'="Yes",
                      '98'="Don't Know")) %>%
  mutate(DISPL_WHERE = recode(DISPL_WHERE,
                              '1'="Return to country of origin",
                              '2'="Move to other city",
                              '3'="Move to other country",
                              '4'="Don't know",
                              '5'="Prefer not to say"))

#prop.table(table(d_int$DISPL_INTENTIONS))
#prop.table(wtd.table(d_int$DISPL_INTENTIONS, weights=main$weights))

```

Just 8% of informants declared to have the intention to move to another place at the time of the survey. The graph below highlights the type of places that the respondents would like to go:

```{r disp_where}
T_W <- (as.data.frame(wtd.table(d_int$DISPL_WHERE, weights = d_int$weights))) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1))

ggplot(T_W, aes(reorder(Var1, -Percent), Percent)) +
    geom_col(fill="#0072bc", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=3) +
    xlab("") + 
    ggtitle("Place intended to move") +
    theme(panel.background = element_rect(fill="white"),
          axis.text=element_text(size=8),
          axis.title=element_text(size=10,face="bold"),
          plot.title = element_text(face="bold", size=14, hjust=0.25))
          

```

Almost half of people with the intention to move from their current location want to travel to another city of Ecuador. Near of 20% would like to return to their country of origin, and a similar percentage would like to travel to a third country.


```{r dis_reasons}
d_rea <- main %>%
  select("DISPL_REASONS", region, weights) %>%
  mutate(DISPL_REASONS = recode(DISPL_REASONS,
                      '1'="Loss of work",
                      '2'="Loss of house",
                      '3'="Lack of health services",
                      '4'="Caring for relatives",
                      '5'="Lack of documentation",
                      '6'="Fear of insecurity",
                      '7'="Xenophobia and discrimination",
                      '8'="Other"))

T_R <- (as.data.frame(wtd.table(d_rea$DISPL_REASONS, weights=d_rea$weights))) %>% 
          mutate(Percent=round(100*Freq/sum(Freq),1))  
  
ggplot(T_R, aes(x=reorder(Var1, Percent), y=Percent)) +
    geom_bar(stat="identity", fill="#0072bc", alpha=.6, width=.9) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=3) +
    coord_flip() + 
    xlab("") + 
    ggtitle("Reasons for the intention of a new displacement") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_blank(),
          axis.title.x=element_blank(),
          axis.ticks.x = element_blank(),
          plot.title = element_text(face= "bold", size=12, hjust=0.5))

```

Loss of work is the main reason for people willing to move from their current area of residence.

```{r}
rm(aux, d_int, d_rea, Prov, region, region2, spn, spn2, T_R, T_W)
```


# <span style="color:#0072BC">**RMS Indicators**</span>

The following part is highlighting the calculation of the baselines of some impact and outcome indicators of Ecuador Multi-year Strategy that should be reported in COMPASS. It should be noted that Ecuador will not report Impact Area 4 nor Outcome Areas 3, 9, 12 and 14 because they are outside of the scope of the multi-year strategy.

The current report is highlighting differences between **Venezuelan** and **Colombian** people, and between region of coverage of the sub-offices. However, additional variables should be further added in next instances of RMS reports.

```{r char_to_numeric}
labelled_chr2dbl <- function(x) {
  varlab <- var_label(x)
  vallab <- val_labels(x)
  vallab <- setNames(as.numeric(vallab),
                     names(vallab))
  x <- as.numeric(as.character(x))
  var_label(x) <- varlab
  val_labels(x) <- vallab
  x
}
```

```{r dissag for indic}
#####Standard scripts for RMS 

###Disaggregation Variables

###Country of Origin --- REF02
###Region of coverage --- region
###Age categories --- HH07_cat
###Gender of HH head --- HH04 (filter for when HH03==1)
###Disability --- disab

```

```{r IMPACT 2.2, include=FALSE}
###2.2 Proportion of PoCs residing in physically safe and secure settlements with access to basic facilities.
##Module :	HEA01-HEA03 (health) + LIGHT01-LIGHT03 (9.2) + DWA01-DWA04 (12.1) + DWE01-DWE05 & DWE08 - DWE09 (9.1)

##Step1. Calculate access to health facilities -according to Sphere standards- it should be reachable within 1 hour 

####Access to health facility: If respondent knows where to reach within 1 hour distance (any type of transport)
class(main$HEA01) #character
class(main$HEA03) #integer

main$HEA01 <- as.character(main$HEA01)
main$HEA03 <- as.integer(main$HEA03)

#main$HEA01_num <- labelled_chr2dbl(main$HEA01)
#class(main$HEA01_num) #double

main$HEA01_num <- as.double(main$HEA01)

main <- main %>%
  mutate(health_acc=
           case_when(HEA01_num!=98 & HEA03 <= 60 ~ 1,
                     TRUE ~ 0)
  ) %>%
  mutate( health_acc = labelled(health_acc,
                               labels = c(
                                 "Health facility is available" = 1,
                                 "Health facilitiy is not available" = 0
                               ),
                               label = "Access to health facilities"))
      
#Step2. calculate percentage of PoC having access to clean fuel for lighting and / or basic connectivity (9.2)
###for LIGHT02 Only include options based on metadata (exclude diesel generator, candles, kerosene)

#main$LIGHT01_num <- labelled_chr2dbl(main$LIGHT01)
#main$LIGHT02_num <- labelled_chr2dbl(main$LIGHT02)
#main$LIGHT03_num <- labelled_chr2dbl(main$LIGHT03)

main$LIGHT01_num <- as.double(main$LIGHT01)
main$LIGHT02_num <- as.double(main$LIGHT02)
main$LIGHT03_num <- as.double(main$LIGHT03)

main <- main %>% 
  mutate(electricity=
           case_when(LIGHT01_num==1 & 
                       (LIGHT03_num!=1 | LIGHT03_num!=96 | LIGHT03_num!=98 ) ~ 1,
                     TRUE ~ 0)
  ) %>%
  mutate( electricity = labelled(electricity,
                                labels = c(
                                  "Yes" = 1,
                                  "No" = 0
                                ),
                                label = "Access to electricity"))

main <- main %>% 
  mutate(outcome9_2=
           case_when(LIGHT01_num==1 & 
                      (LIGHT02_num==1 | LIGHT02_num==3 |
                       LIGHT02_num==4 | LIGHT02_num==5 |
                       LIGHT02_num==6 | LIGHT02_num==7 |
                       LIGHT02_num==8)  ~ 1,
                     TRUE ~ 0))

#Step3. calculate percentage of PoCs using at least basic water services (12.1)
###Improved drinking water resource that is accessible under 30 minutes in the last 30 days

#main$DWA03a_num <- labelled_chr2dbl(main$DWA03a)
#main$DWA02_num <- labelled_chr2dbl(main$DWA02)
#main$DWA01_num <- labelled_chr2dbl(main$DWA01)
#main$DWA04_num <- labelled_chr2dbl(main$DWA04)

main$DWA03a_num <- as.double(main$DWA03a)
main$DWA02_num <- as.double(main$DWA02)
main$DWA01_num <- as.double(main$DWA01)
main$DWA04_num <- as.double(main$DWA04)

class(main$DWA03a_num)
class(main$DWA03b)

main <- main %>%
  
  mutate(time_DWA=case_when(
    DWA03a_num==1~1, DWA03a_num==2~60)
  ) %>%
  mutate(time_tot=time_DWA*DWA03b
  ) %>%
  mutate(dwa_cond1=case_when( time_tot > 30 ~ 0, TRUE ~ 1) ##Accessible under 30 minutes
  ) %>%
  mutate(dwa_cond2=case_when(DWA01_num!=7 | DWA01_num != 13 | DWA01_num != 96 | DWA01_num !=98 ~ 1,
                             TRUE ~ 0) ## protected source
  ) %>%
  mutate(dwa_cond3=case_when(DWA04_num==1 ~ 0, TRUE ~ 1) ## It was available in the last 30 days
  ) %>%
  mutate(drinkingwater=case_when(
    (dwa_cond1==1 & dwa_cond2==1 & dwa_cond3==1) ~ 1, TRUE ~ 0)
  ) %>%
  mutate(drinkingwater = labelled(drinkingwater,
                                 labels = c(
                                   "Yes" = 1,
                                   "No" = 0
                                 ),
                                 label = "Access to drinking water"))

#main$drinkingwater

##Step.4. indicator aims to measure the proportion of persons of concern that reside in safe 
###and secure settlements with access to basic services such as shelter

###Calculate DWE01 to DWE04 for shelter

###Turn all variables into numeric

#main$DWE01_num <- labelled_chr2dbl(main$DWE01)
#main$DWE02_num <- labelled_chr2dbl(main$DWE02)
#main$DWE03_num <- labelled_chr2dbl(main$DWE03)
#main$DWE04_num <- labelled_chr2dbl(main$DWE04)

main$DWE01_num <- as.double(main$DWE01)
main$DWE02_num <- as.double(main$DWE02)
main$DWE03_num <- as.double(main$DWE03)
main$DWE04_num <- as.double(main$DWE04)

class(main$DWE05)

##classify DWE01 as 1 when it has decent quality/improved 

main <- main %>%
  
  mutate(dwe01_cat=case_when( #Only apartment and house
         (DWE01_num==1 | DWE01_num==2) ~ 1, TRUE ~ 0 )
  ) %>%
  mutate(dwe02_cat=case_when( #unimproved floor when earth,sand,clay,mud, dung or other
    (DWE02_num>2 & DWE02_num<96) ~ 1, TRUE ~ 0 )
  ) %>%
  mutate(dwe03_cat=case_when( #unimproved roof all options except metal,wood,ceramic tiles, cement, roofing shingles/sheets
    (DWE03_num==8 | DWE03_num==9 | DWE03_num==10 | DWE03_num==11 |
       DWE03_num==12 | DWE03_num==13) ~ 1 , TRUE ~ 0)
  ) %>%
  mutate(dwe04_cat=case_when( #improved wall: cement,stone,bricks,cement blocks, covered adobe, wood planks
    (DWE04_num==10 | DWE04_num==11 | DWE04_num==12 | DWE04_num==13 | DWE04_num==14 | DWE04_num==15) ~ 1,
  TRUE ~ 0)
  ) 


####Calculate crowding index

main <- main %>%
  
  mutate(crowding=HH01/DWE05
  ) %>%
  mutate(dwe05_cat=case_when( ##if crowding < 3 
    crowding <= 3 ~ 1, TRUE ~ 0)
  )
    
## Add DWE08 and DWE09 to calculations - if HH is paying rent, can they afford to pay rent without financial distress


#main$DWE08_num <- labelled_chr2dbl(main$DWE08)
#main$DWE09_num <- labelled_chr2dbl(main$DWE09)

main$DWE08_num <- as.double(main$DWE08)
main$DWE09_num <- as.double(main$DWE09)


main <- main %>%
  
  mutate(dwe09_cat=case_when( #affordable if HH pays rent and often or always without financial distress
   (DWE08_num==1 & (DWE09_num==1 | DWE09_num==2)) ~ 1, 
     (DWE08_num==1 & (DWE09_num==3 | DWE09_num==4)) ~ 0,  DWE08_num==0 ~ NA_real_)
  )

####Combine all shelter indicators 

##dwe01_cat / dwe02_cat / dwe03_cat / dwe04_cat / dwe05_cat / dwe09_cat


main <- main %>%
  
  mutate(shelter=case_when(
    dwe01_cat==0 | dwe02_cat==0 | dwe03_cat==0 | dwe04_cat==0 | dwe05_cat==0 | dwe09_cat==0  ~ 0, 
    dwe01_cat==1 & dwe02_cat==1 & dwe03_cat==1 & dwe04_cat==1 & dwe05_cat==1 & dwe09_cat==1 ~ 1, TRUE ~ NA_real_)
    ) %>%
  mutate( shelter = labelled(shelter,
                                 labels = c(
                                   "Yes" = 1,
                                   "No" = 0
                                 ),
                                 label = "Habitable and affordable shelter"))
    

###Step5. Calculate impact indicator based on shelter, electricity, drinking water and health_access

main <-main %>%
  
  mutate(impact2_2=case_when(
    shelter==0 | electricity==0 | drinkingwater==0 | health_acc==0 ~ 0,
    shelter==1 & electricity==1 & drinkingwater==1 & health_acc==1 ~ 1)
  ) %>% 
  mutate(impact2_2=labelled(impact2_2,
                            labels =c(
                              "Yes"=1,
                              "No"=0
                            ),
                  label="PoCs residing in physically safe and secure settlements with access to basic facilities"))

#main %>% filter(dwe09_cat==1) %>% group_by(dwe01_cat) %>% summarise(n = n()) %>% ungroup %>% mutate(t01=sum(n))

prop.table(wtd.table(main$shelter, weights = main$weights, useNA="ifany"))
prop.table(wtd.table(main$electricity, weights = main$weights, useNA="ifany"))
prop.table(wtd.table(main$drinkingwater, weights = main$weights, useNA="ifany"))
prop.table(wtd.table(main$health_acc, weights = main$weights, useNA="ifany"))

```

```{r IMPACT 2.3, include=FALSE}
###2.3 Proportion of PoC with access to health services.
##Module :HACC01 - HACC04

####Individual level indicator asked all HH members in standard form

#### *** BUT DIFFERENT IN ECUADOR ***
#### Given that our survey was carried up through phone, the questions about access to health services was delivered only to the key informant of the household.

#### So, again, we will to use de main dataframe

#ind$HACC01_num <- labelled_chr2dbl(ind$HACC01
#ind$HACC03_num <- labelled_chr2dbl(ind$HACC03)
main$HACC01_num <- as.double(main$HACC01)
main$HACC03_num <- as.double(main$HACC03)

class(main$HACC04.1)

#Calculate those who were not able to access due to reasons unrelated to asked services (when HACC04 is 7/8/96)

main <- main %>%
  
  mutate(health_NOacc=case_when(
      HACC03_num==1 & (HACC04.7==1 | HACC04.8==1 | HACC04.96==1 ) ~ 0,
      HACC03_num==1 & 
      (HACC04.1==1 | HACC04.2==1 | HACC04.3==1 | HACC04.4==1 | HACC04.5==1 | 
         HACC04.6==1 | HACC04.9==1) ~ 1, TRUE ~ 0)
  ) %>% ## Those who needed services
  mutate(HACC_need=HACC01_num + health_NOacc
  ) %>%
  mutate(impact2_3=HACC01_num/HACC_need 
  ) %>%
  mutate(impact2_3=case_when(
    impact2_3==1 ~ 1, impact2_3==0.5 ~ 0,
    impact2_3==0 ~ 0, TRUE ~ NA_real_ )) %>% 
  mutate(impact2_3=labelled(impact2_3,
                             labels =c(
                               "Yes"=1,
                               "No"=0
                             ),
                             label="PoC has access to health services in the last 30 days when needed"))

#calculate overall impact2_3
class(main$impact2_3)
mean(is.na(main$impact2_3))

# main <- main %>%
# mutate(impact2_3=case_when(
#       HACC03_num==1 & (HACC04.7==1 | HACC04.8==1 | HACC04.96==1 ) ~ 0,
#       HACC03_num==1 & (HACC04.1==1 | HACC04.2==1 | HACC04.3==1 |HACC04.4==1 | HACC04.5==1 | HACC04.6==1 | HACC04.9==1) ~ 1, TRUE ~ NA_real_))

```

```{r IMPACT 3.2: a & b, include=FALSE}
###3.2a: Proportion of PoC enrolled in primary education regardless of age
##Module :EDU01-EDU04

#Turn character variables into vector
#ind$EDU01_num <- labelled_chr2dbl(ind$EDU01)
#ind$EDU02_num <- labelled_chr2dbl(ind$EDU02)
#ind$EDU03_num <- labelled_chr2dbl(ind$EDU03)

ind$EDU01_num <- as.double(ind$EDU01_Enroll)
ind$EDU02_num <- as.double(ind$EDU02)
ind$EDU03_num <- as.double(ind$EDU03)

ind <- ind %>% 
   mutate(edu_enrollpri=case_when(
     EDU01_num==1 & EDU02_num==1 & EDU03_num==2 ~ 1, EDU01_num==0 | EDU02_num==0 ~ 0, TRUE ~ 0)
   ) %>%
   mutate(age_primary=case_when(
     HH07 >= 5 & HH07 <=11 ~ 1, TRUE ~ 0) #Contextualise age group for primary school attendance 
   ) %>%
  mutate(age_impact3_2a=case_when(
    edu_enrollpri==1 & age_primary==1 ~ 1, 
    edu_enrollpri==0 & age_primary==1 ~ 0, TRUE ~ NA_real_)
    ) %>% 
  mutate(impact3_2a=sum(edu_enrollpri)/sum(age_primary)
   ) %>%
   mutate(impact3_2a=labelled(impact3_2a,
                              labels =c(
                                "Yes"=1,
                                "No"=0
                              ),
                              label="PoC enrolled in primary education"))
 
#mean(ind$old_impact3_2a, is.na=FALSE)



 
###3.2b: Proportion of PoC enrolled in secondary education
##Module :EDU01-EDU04
 
 #Turn character variables into vector
#ind$EDU01_num <- labelled_chr2dbl(ind$EDU01)
#ind$EDU02_num <- labelled_chr2dbl(ind$EDU02)
#ind$EDU03_num <- labelled_chr2dbl(ind$EDU03)
 
 #Include if they are attending secondary or secondary -technical and vocational
ind <- ind %>% 
   mutate(edu_enrollsec=case_when(
     EDU01_num==1 & EDU02_num==1 & (EDU03_num==3 | EDU03_num==4) ~ 1, EDU01_num==0 | EDU02_num==0 ~ 0, TRUE ~ 0)
   ) %>%
   mutate(age_secondary=case_when(
     HH07 >= 12 & HH07 <=18 ~ 1, TRUE ~ 0) #Contextualise age group for secondary school attendance 
   ) %>%
  mutate(age_impact3_2b=case_when(
    edu_enrollsec==1 & age_secondary==1 ~ 1,
    edu_enrollsec==0 & age_secondary==1 ~ 0,
    TRUE ~ NA_real_)) %>% 
   mutate(impact3_2b=sum(edu_enrollsec)/sum(age_secondary)
   ) %>%
   mutate(impact3_2b=labelled(impact3_2b,
                             labels =c(
                               "Yes"=1,
                               "No"=0
                             ),
                             label="PoC enrolled in secondary education"))

#mean(ind$old_impact3_2b)

```

```{r IMPACT 3.3}
###3.3 Proportion of PoC feeling safe walking alone in their neighborhood
##Module :SAF01

 ##This indicator comes from main dataset based on the key respondent 

 #Turn character variables into vector
#main$SAF01_num <- labelled_chr2dbl(main$SAF01)
main$SAF01_num <- as.double(main$SAF01)

#if unsafe or very unsafe 0 - if don't know - 98 include, refusals will go into missing
  main <- main %>%
   mutate(impact3_3=case_when(
     SAF01_num==1 | SAF01_num==2 ~ 1,
     SAF01_num==3 | SAF01_num==4 |  SAF01_num==5 | SAF01_num==98 ~ 0, SAF01_num==99 ~ NA_real_)
   ) %>% 
    mutate(impact3_3=labelled(impact3_3,
                                   labels =c(
                                     "Yes"=1,
                                     "No"=0
                                   ),
                                   label="PoC feeling safe walking alone"))
  
```

```{r OUTCOME 1.2}

###1.2 Proportion of children <5 years whose birth have been registered with a civil authority
##Module :REG03 - REG04
  
#  ind$REG03_num <- labelled_chr2dbl(ind$REG03) # birth certificate
#  ind$REG04_num <- labelled_chr2dbl(ind$REG04) # birth has been registered

ind$REG03_num <- as.double(ind$REG03) 
ind$REG04_num <- as.double(ind$REG04) 

##Calculate children who has a birth certificate
  
ind <- ind %>%
    mutate(birthCertificate=case_when(
      REG03_num==0 | REG03_num==98 ~ 0, REG03_num==1 ~ 1)
           ) %>%
    mutate(birthCertificate=labelled(birthCertificate,
                                  labels=c(
                                    'Yes'=1,
                                    'No'=0
                                  ),
                                  label="Children under 5 with a birth certificate"))

##Calculate children who has been registered with civil authorities
  
ind <- ind %>%
    mutate(birthRegistered=case_when(
      REG04_num==0 | REG04_num==98 ~ 0, REG04_num==1 ~ 1, 
      REG04_num==99 ~ NA_real_)
    ) %>%
    mutate(birthRegistered=labelled(birthRegistered,
                                  labels=c(
                                    'Yes'=1,
                                    'No'=0
                                  ),
                                  label="Children under 5 birth registered with civil authorities"))
  

##Calculate outcome indicator 1.2

# ind <- ind %>%
#     mutate(outcome1_2=case_when(
#       birthRegistered==1 & HH07.y <5 ~ 1, 
#       birthRegistered==0 & HH07.y <5 ~ 0)
#     ) %>%
#     mutate(outcome1_2=labelled(outcome1_2,
#                                     labels=c(
#                                       'Yes'=1,
#                                       'No'=0
#                                     ),
#                                     label="Proportion of children under 5 birth registered with civil authorities"))

#>>> For ECUADOR: ******change --->>> REVIT (and form!)

ind <- ind %>%
    mutate(outcome1_2=case_when(
      birthCertificate==1 & HH07 <5 ~ 1, 
      birthCertificate==0 & HH07 <5 ~ 0)
    ) %>%
    mutate(outcome1_2=labelled(outcome1_2,
                                    labels=c(
                                      'Yes'=1,
                                      'No'=0
                                    ),
                                    label="Proportion of children under 5 birth registered with civil authorities"))

```

```{r OUTCOME 1.3}
###1.3 Proportion of PoC with legally recognized identity documents or credentials
##Module :REG01 - REG02 - REG05 - REG06
  
###Calculate having documents for children under 5
  
##Turn into numeric variables 
  
  # ind$REG05a_num <- labelled_chr2dbl(ind$REG05a) # passport
  # ind$REG05b_num <- labelled_chr2dbl(ind$REG05b) # civil/government issued ID
  # ind$REG05c_num <- labelled_chr2dbl(ind$REG05c) # residency permit
  # ind$REG05d_num <- labelled_chr2dbl(ind$REG05d) # statelessness documentation
  # ind$REG05e_num <- labelled_chr2dbl(ind$REG05e) # household card of address/family book
  # ind$REG05f_num <- labelled_chr2dbl(ind$REG05f) # social security card
  # ind$REG06_num <- labelled_chr2dbl(ind$REG06) # any other document establishes identity

ind$REG05a_num <- as.double(ind$REG05a) # valid passport 
ind$REG05b_num <- as.double(ind$REG05b) # valid ID
ind$REG05h_num <- as.double(ind$REG05h) # expired passport
ind$REG05i_num <- as.double(ind$REG05i) # expired ID

ind$REG06_num <- as.double(ind$REG06) # any other document establishes identity

ind <- ind %>%
    mutate(document_under5=case_when(
      REG05a_num==1 | REG05b_num==1 | REG06_num==1 ~ 1, 
      REG05h_num==1 | REG05i_num==1 | REG06_num==0 ~ 0, TRUE ~ NA_real_
    ))
  
###Calculate having documents for above 5
  
##Turn into numeric variables 
  # ind$REG01a_num <- labelled_chr2dbl(ind$REG01a) # passport
  # ind$REG01b_num <- labelled_chr2dbl(ind$REG01b) # birth certificate
  # ind$REG01c_num <- labelled_chr2dbl(ind$REG01c) # civil/ government issued ID
  # ind$REG01d_num <- labelled_chr2dbl(ind$REG01d) # residency permit
  # ind$REG01e_num <- labelled_chr2dbl(ind$REG01e) # statelessness documentation
  # ind$REG01f_num <- labelled_chr2dbl(ind$REG01f) # household card of address/family book
  # ind$REG01g_num <- labelled_chr2dbl(ind$REG01g) # social security card
  # ind$REG02_num <- labelled_chr2dbl(ind$REG02) # any other document establishes identity


ind$REG01a_num <- as.double(ind$REG01a) # valid passport
ind$REG01b_num <- as.double(ind$REG01b) # birth certificate
ind$REG01c_num <- as.double(ind$REG01c) # valid ID
ind$REG01h_num <- as.double(ind$REG01h) # expired passport
ind$REG01i_num <- as.double(ind$REG01i) # expired ID
ind$REG01j_num <- as.double(ind$REG01j) # copy of ID
ind$REG01k_num <- as.double(ind$REG01k) # complaint for loss

ind$REG02_num <- as.double(ind$REG02) # any other document establishes identity

ind <- ind %>%
    mutate(document_above5=case_when(
      REG01a_num==1 | REG01c_num==1 | REG02_num==1 ~ 1,
      REG01h_num==1 | REG01i_num==1 | REG02_num==0 ~ 0, TRUE ~ NA_real_)
      
##calculate outcome indicator by combining under 5 and above 5 responses
    ) %>%
    mutate(outcome1_3=case_when(
     (document_above5==1 | document_under5==1) ~ 1,  
     (document_above5==0 | document_under5==0) ~ 0)
    ) %>%
    mutate(outcome1_3=labelled(outcome1_3,
                               labels=c(
                                 'Yes'=1,
                                 'No'=0
                               ),
                               label="PoCs with legally recognized documents"
                               ))

```

```{r OUTCOME 4.1}

###4.1 Proportion of PoC who know where to access available GBV services
##Module :GBV01
  
  ##Turn into numeric variables for services
  
  # main$GBV01a_num <- labelled_chr2dbl(main$GBV01a) # health services
  # main$GBV01b_num <- labelled_chr2dbl(main$GBV01b) # psycho-social services
  # main$GBV01c_num <- labelled_chr2dbl(main$GBV01c) # safety and security services
  # main$GBV01d_num <- labelled_chr2dbl(main$GBV01d) # legal assistance

main$GBV01a_num <- as.double(main$GBV01a) # health services
main$GBV01b_num <- as.double(main$GBV01b) # psycho-social services
main$GBV01c_num <- as.double(main$GBV01c) # safety and security services
main$GBV01d_num <- as.double(main$GBV01d) # legal assistance
  
main <- main %>%
    mutate(outcome4_1=case_when(
      GBV01a_num==1 |  GBV01b_num==1 |  GBV01c_num==1 |  GBV01d_num==1 ~ 1,
      TRUE ~ 0)
    ) %>%
    mutate(outcome4_1=labelled(outcome4_1,
                               labels=c(
                                 'Yes'=1,
                                 "No"=0
                               ),
                               label="Poc who know where to access available GBV services"
                               ))
  
```

```{r OUTCOME 4.2}
###4.2 Proportion of PoC who do not accept violence against women
##Module :VAW01
  
#Original approach: If randomly selected adult who believes a husband is justified in beating his wife in various circumstances

#Ecuador's approach: the key informant answered about this concern, if they approve the gbv_screen question

#Turn into numeric variables
  # main$VAW01a_num <- labelled_chr2dbl(main$VAW01a)
  # main$VAW01b_num <- labelled_chr2dbl(main$VAW01b)
  # main$VAW01c_num <- labelled_chr2dbl(main$VAW01c)
  # main$VAW01d_num <- labelled_chr2dbl(main$VAW01d)
  # main$VAW01e_num <- labelled_chr2dbl(main$VAW01e)

main$VAW01a_num <- as.double(main$VAW01a)
main$VAW01b_num <- as.double(main$VAW01b)
main$VAW01c_num <- as.double(main$VAW01c)
main$VAW01d_num <- as.double(main$VAW01d)
main$VAW01e_num <- as.double(main$VAW01e)

##If yes selected for any of the circumstances
main <- main %>%
   mutate(outcome4_2=case_when(
     VAW01a_num==1 | VAW01b_num==1 |  VAW01c_num==1 |  VAW01d_num==1 | VAW01e_num==1 ~ 1,
     VAW01a_num==0 & VAW01b_num==0 &  VAW01c_num==0 &  VAW01d_num==0 & VAW01e_num==0 ~ 0,
     TRUE ~ NA_real_)
   ) %>%
   mutate(outcome4_2=labelled(outcome4_2,
                              labels=c(
                                'Yes'=1,
                                "No"=0
                              ),
                              label="Poc who do not accept violence against women"
   ))

#Maybe, we need to sum people that do not feel comfortable talking about domestic violence plus those that accepts any kind of aggression

```

```{r OUTCOME 5.2}
###5.2 Proportion of children who participate in community-based child protection programmes
##Module :COMM01-COMM04
 
#Turn into numeric variables
 # ind$COMM01_num <- labelled_chr2dbl(ind$COMM01)
 # ind$COMM02_num <- labelled_chr2dbl(ind$COMM02)
 # ind$COMM03_num <- labelled_chr2dbl(ind$COMM03)
 # ind$COMM04_num <- labelled_chr2dbl(ind$COMM04)

ind$COMM01_num <- as.double(ind$COMM01)
ind$COMM02_num <- as.double(ind$COMM02)
ind$COMM03_num <- as.double(ind$COMM03)
ind$COMM04_num <- as.double(ind$COMM04)
 
#Children who attended at least 2 times, under adult supervision in a physically safe area
 
ind <- ind %>%
   mutate(outcome5_2=case_when(
     (COMM01_num==1 & COMM02_num >=2 & COMM03_num==1 & COMM04_num==1) ~ 1,
     COMM01_num==0 | COMM02_num < 2 | COMM03_num==0 | COMM03_num==98 |
       COMM04_num==0 | COMM04_num==98 ~ 0, TRUE ~ NA_real_)
   ) %>%
   mutate(outcome5_2=labelled(outcome5_2,
                              labels=c(
                                'Yes'=1,
                                "No"=0
                              ),
                              label="Poc of children who participate in community-based child protection programmes"
   ))

```

```{r OUTCOME 8.2}
###8.2 Proportion of PoC with primary reliance on clean (cooking) fuels and technology
##Module :COOK01-COOK03
 
###Based on MICS calculation : TC4.1
# see https://mics.unicef.org/files?job=W1siZiIsIjIwMTcvMDIvMDMvMTYvMjcvMjUvNTk5L1BpY3RvcmlhbHNfV0hPX0hvdXNlaG9sZF9FbmVyZ3lfVXNlX0NhdGFsb2d1ZV9TZXB0ZW1iZXJfMjAxNl8ucGRmIl1d&sha=57b4a452fcc0ac88
 
 # main$COOK01_num <- labelled_chr2dbl(main$COOK01)
 # main$COOK02_num <- labelled_chr2dbl(main$COOK02)
 # main$COOK03_num <- labelled_chr2dbl(main$COOK03)

main$COOK01_num <- as.double(main$COOK01)
main$COOK02_num <- as.double(main$COOK02)
main$COOK03_num <- as.double(main$COOK03)
 
main <- main %>%
   mutate(
     outcome8_2 = case_when(
       COOK01_num == 1 & (COOK02 %in% c("1", "2", "3", "4", "5") | (COOK02 %in% c("6", "96") & COOK03 %in% c("1", "2", "3", "22"))) ~ 1, 
       COOK01_num == 1 & (COOK02 %in% c("7", "8", "9", "10") | (COOK02 %in% c("6", "96") & !(COOK03 %in% c("1", "2", "3", "22")))) ~ 0,
       COOK01_num == 0 ~ NA_real_
     )
   ) %>%
   mutate(
     outcome8_2 = labelled(outcome8_2,
                            labels = c(
                              "No" = 0,
                              "Yes" = 1
                            ),
                            label = "PoC with primary reliance on clean (cooking) fuels and technology"
     ))

```

```{r OUTCOME 10.1}
###10.1 Proportion of children 9mo-5years who have received measles vaccination
##Module :MMR01-MMR04 ##  MICS TC.1.1 UNICEF calculates on the first dose received##

#Calculate into numeric
#ind$MMR03_num <- labelled_chr2dbl(ind$MMR03)

ind$MMR03_num <- as.double(ind$MMR03)

##Children who had at least one dose of measles vaccination

ind <- ind %>%
  mutate(outcome10_1=case_when(
    MMR03_num==1 ~ 1, MMR03_num==0  | MMR03_num==98 ~ 0)
  ) %>%
  mutate( outcome10_1 = labelled(outcome10_1,
                                labels = c(
                                  "Yes" = 1,
                                  "No" = 0
                                ),
                                label = "Children 9mo-5years who have received measles vaccination"))

```

```{r OUTCOME 10.2}
###10.2 Proportion of births attended by skilled health personnel
##Module :BIR01-BIR04

##If there are live births in the last 2 years

# main$BIR03_num <- labelled_chr2dbl(main$BIR03)
# main$BIR01_num <- labelled_chr2dbl(main$BIR01)
# main$BIR02_num <- labelled_chr2dbl(main$BIR02)

main$BIR03_num <- as.double(main$BIR03)
main$BIR01_num <- as.double(main$BIR01)
main$BIR02_num <- as.double(main$BIR02)


main <- main %>%
  mutate(outcome10_2=case_when( 
    (BIR01_num==1 | BIR02_num==1) & (BIR03_num==1 | BIR03_num==2 | BIR03_num==3 ) ~ 1,
    (BIR01_num==1 | BIR02_num==1) & (BIR03_num==4 | BIR03_num==5 | BIR03_num==6 | BIR03_num==96 | BIR03_num==98) ~ 0, 
    TRUE ~ NA_real_)
  ) %>%
  mutate( outcome10_2 = labelled(outcome10_2,
                                 labels = c(
                                   "Yes" = 1,
                                   "No" = 0
                                 ),
                                 label = "Births attended by skilled health personnel"))
```

```{r OUTCOME 13.1}
###13.1 Proportion of PoC with an account at a bank or other financial institution or with a mobile-money service provider
##Module :BANK01-BANK05

# main$BANK01_num <- labelled_chr2dbl(main$BANK01)
# main$BANK02_num <- labelled_chr2dbl(main$BANK02)
# main$BANK03_num <- labelled_chr2dbl(main$BANK03)
# main$BANK04_num <- labelled_chr2dbl(main$BANK04)
# main$BANK05_num <- labelled_chr2dbl(main$BANK05)

main$BANK01_num <- as.double(main$BANK01)
main$BANK02_num <- as.double(main$BANK02)
main$BANK03_num <- as.double(main$BANK03)
main$BANK04_num <- as.double(main$BANK04)
main$BANK05_num <- as.double(main$BANK05)

##include if the respondent has an account on their own/with someone else, ATM card, personal bank card
##or personally used phone to send money (proxy)

main <- main %>%
  mutate(
    outcome13_1 = case_when(
    HH07>=15 & (BANK01_num==1 | BANK02_num==1 | BANK03_num==1 | BANK05_num==1) ~ 1,
    HH07>=15 & (BANK01_num==0 & BANK02_num==0 & BANK03_num==0 & BANK04_num==0) ~ 0,
      TRUE ~ 0)
  ) %>%
  mutate(outcome13_1 = labelled(outcome13_1,
                            labels = c(
                              "Yes" = 1,
                              "No" = 0
                            ),
                            label = "PoC with an account at a bank or other financial institution or 
                            with a mobile-money service provider")
  )

```

```{r OUTCOME 13.2}
###13.2 Proportion of PoC who self-report positive changes in their income compared to previous year
##Module :INC01

### Only calculate as positive if they responded 'more' 

#main$INC01_num <- labelled_chr2dbl(main$INC01)

main$INC01_num <- as.double(main$INC01)

main <- main %>%
  mutate(outcome13_2=case_when(
   HH07 >=15 & INC01_num==1 ~ 1,
   HH07 >=15 & (INC01_num==2 | INC01_num==3 | INC01_num==98) ~ 0 ) 
  ) %>%
  mutate(outcome13_2 = labelled(outcome13_2,
                                labels = c(
                                  "Yes" = 1,
                                  "No" = 0
                                ),
                                label = "PoC who self-report positive changes in their income compared
                                to previous year")
  )
```

```{r OUTCOME 13.3}
###13.3 Proportion of PoC (working age) who are unemployed

####Numerator: Those of working age who were not in employment, looked for employment in the past 30 days and were available to take up employment i the next 14 days
####Denominator: Those of working age in labour force

###Turn into numeric variables

# main$UNEM01_num <- labelled_chr2dbl(main$UNEM01)
# main$UNEM02_num <- labelled_chr2dbl(main$UNEM02)
# main$UNEM03_num <- labelled_chr2dbl(main$UNEM03)
# main$UNEM04_num <- labelled_chr2dbl(main$UNEM04)
# main$UNEM05_num <- labelled_chr2dbl(main$UNEM05)
# main$UNEM06_num <- labelled_chr2dbl(main$UNEM06)
# main$UNEM07_num <- labelled_chr2dbl(main$UNEM07)
# main$UNEM08_num <- labelled_chr2dbl(main$UNEM08)
# main$UNEM09_num <- labelled_chr2dbl(main$UNEM09)
# main$UNEM10_num <- labelled_chr2dbl(main$UNEM10)

main$UNEM01_num <- as.double(main$UNEM01)
main$UNEM02_num <- as.double(main$UNEM02)
main$UNEM03_num <- as.double(main$UNEM03)
main$UNEM04_num <- as.double(main$UNEM04)
main$UNEM05_num <- as.double(main$UNEM05)
main$UNEM06_num <- as.double(main$UNEM06)
main$UNEM07_num <- as.double(main$UNEM07)
main$UNEM08_num <- as.double(main$UNEM08)
main$UNEM09_num <- as.double(main$UNEM09)
main$UNEM10_num <- as.double(main$UNEM10)


main <- main %>%
  mutate(employed=case_when(
    HH07>=15 & 
    UNEM01_num==1 ~ 1,
    UNEM02_num==1 & UNEM07_num==3 ~ 1,
    UNEM04_num==1 ~ 1,
    UNEM02_num==1 & (UNEM07_num==1 | UNEM07_num==2) & (UNEM08_num==1 | UNEM08_num==2) ~ 1,
    UNEM05_num==1 & UNEM06_num==3 ~ 1,
    UNEM05_num==1 & (UNEM06_num==1 | UNEM06_num==2) & (UNEM08_num==1 | UNEM08_num==2) ~ 1,
    UNEM03_num==1 & (UNEM08_num==1 | UNEM08_num==2) ~ 1)
  ) %>%
  mutate(unemployed=case_when(
    (UNEM09_num==1 & UNEM10_num==1) & HH07>=15 ~ 1,
    TRUE ~ 0)
  ) %>%
  mutate(labour_force=case_when(
    (employed==1 | unemployed==1) & HH07>=15 ~ 1)
  ) %>%
  mutate(outcome13_3=unemployed/labour_force)

#I have some adjusts: include UNEM07==2 for UNEM02==1, UNEM03, and delete employed==0 in labor force

# main <- main %>% mutate(unemp_rate=
#                           case_when(employed==0 & 
#                                       UNEM09==1 & UNEM10==1 ~ 1,
#                                     employed==1 ~ 0,
#                                     TRUE ~ NA_real_))

```

```{r OUTCOME 16.1}
###16.1 Proportion of PoC with secure tenure rights and/or property rights to housing and/or land
##Module :DWE06-DWE07 & DWE10-DWE11

# main$DWE06_num <- labelled_chr2dbl(main$DWE06)
# main$DWE07_num <- labelled_chr2dbl(main$DWE07)
# main$DWE10_num <- labelled_chr2dbl(main$DWE10)
# main$DWE11_num <- labelled_chr2dbl(main$DWE11)

main$DWE06_num <- as.double(main$DWE06)
main$DWE07_num <- as.double(main$DWE07)
main$DWE10_num <- as.double(main$DWE10)
main$DWE11_num <- as.double(main$DWE11)

main <- main %>%
  mutate(housing_cond1=case_when(
         (DWE11_num==1 | DWE11_num==2 ) ~ 1, # likelihood of losing right for housing is unlikely
         TRUE ~ 0)
  ) %>%
  mutate(housing_cond2=case_when(
    DWE10_num==5 ~ 0, # have official documents to proof residency
    DWE10_num==1 | DWE10_num==2 |  DWE10_num==3 | DWE10_num==4 | DWE10_num==96 ~ 1)
  ) %>%
  mutate(housing_cond3=case_when(
    DWE06_num==9 | DWE06_num==98 | DWE06_num==99 ~ 0, 
    DWE07_num==9 | DWE07_num==98 | DWE07_num==99 ~ 0, # owned of the house or field
    TRUE ~ 1)
  ) %>%
  mutate(outcome16_1=case_when(
    housing_cond1==1 & housing_cond2==1 & housing_cond3==1 ~ 1,
    housing_cond1==0 | housing_cond2==0 | housing_cond3==0 ~ 0)
  ) %>%
  mutate(outcome16_1=labelled(outcome16_1,
                             labels=c(
                               'Yes'=1,
                               'No'=0
                             ),
                             label="PoC with secure tenure rights and/or property rights
                             to housing and/or land"))

#I changed some features: official documents include only property right or written contract; and only selecting own house or land

```

```{r OUTCOME 16.2}
###16.2 Proportion of PoC covered by social protection floors/systems
##Module :UNHCR Core Indicator Metadata	SPF01

##Turn into numeric variables

# main$SPF01a_num <- labelled_chr2dbl(main$SPF01a)
# main$SPF01b_num <- labelled_chr2dbl(main$SPF01b)
# main$SPF01c_num <- labelled_chr2dbl(main$SPF01c)
# main$SPF01d_num <- labelled_chr2dbl(main$SPF01d)
# main$SPF01e_num <- labelled_chr2dbl(main$SPF01e)
# main$SPF01f_num <- labelled_chr2dbl(main$SPF01f)
# main$SPF01g_num <- labelled_chr2dbl(main$SPF01g)
# main$SPF01h_num <- labelled_chr2dbl(main$SPF01h)

main$SPF01a_num <- as.double(main$SPF01a)
main$SPF01b_num <- as.double(main$SPF01b)
main$SPF01c_num <- as.double(main$SPF01c)
main$SPF01d_num <- as.double(main$SPF01d)
main$SPF01e_num <- as.double(main$SPF01e)
main$SPF01f_num <- as.double(main$SPF01f)
main$SPF01g_num <- as.double(main$SPF01g)

# If PoC has covered by at least one of the social protection floors/systems
main <- main %>%
  mutate(outcome16_2=case_when(
    SPF01a_num==1 | SPF01b_num==1 | SPF01c_num==1 | SPF01d_num==1 | SPF01e_num==1 | SPF01f_num==1 
     | SPF01g_num==1 ~ 1, 
    TRUE ~ 0)
  ) %>%
  mutate(outcome16_2=labelled(outcome16_2,
                              labels=c(
                                'Yes'=1,
                                'No'=0
                              ),
                              label="PoC covered by social protection floors/systems")) 

```

```{r national indicator values, include=FALSE}
#svytable(~main$outcome16_1, design=svy.dat) %>% prop.table()

#svytable(~ind$impact3_2b, design=svy.ind) %>% prop.table()

```

```{r writing data as output file, include=FALSE}
#write.csv2(main, file = "C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/main.csv")

#write.csv2(ind, file = "C:/Users/PONCECOL/OneDrive - UNHCR/UNHCR_PAPC/RMS sept2022/Análisis/ind.csv")

```


## <span style="color:#00B398">IMPACT AREA 2: REALIZING BASIC RIGHTS IN SAFE ENVIRONMENTS</span>

### Impact indicator 2.2: Proportion of PoCs residing in physically safe and secure settlements with access to basic facilities

```{r i2.2}
I_2.2 <- as.data.frame(svytable(~main$impact2_2, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.impact2_2==1) %>% select(-Freq, -main.impact2_2)

knitr:: kable(I_2.2, 
      col.names = c("PoCs residing in safe and secure settlements 
                    with access to basic facilities"),
      align = "c",
      caption = "Table 1: Impact indicator 2.2 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

#kable_styling(table1, font_size = 12)

```

```{r i2.2 nat}
imp2_2 <- (as.data.frame(wtd.table(main$impact2_2, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(imp2_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 2.2 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))


```

```{r i2.2 reg}
imp2_2 <- (as.data.frame(wtd.table(main$impact2_2, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(imp2_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 2.2 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))


```

At the national level, 13.2% of households are capable to achieve _safe and secure settlements with access to basic facilities_. This composite indicator has 4 components: 

- Access to health facilities: it should be reachable within 1 hour
- Access to clean fuel for lighting: excludes diesel generator, candles, kerosene
- Using at least basic water services: improved drinking water resource that is accessible under 30 minutes in the last 30 days
- Residing in safe and secure settlements with access to basic services such as shelter: materials of roof, walls and floor; crowding; and if household is paying rent, they can afford to pay rent without financial distress.

The calculation of the impact indicator is based on reach simultaneously shelter, electricity, improved drinking water and health access.

### Impact indicator 2.3: Proportion of PoCs with access to health services

```{r i2.3}
I_2.3 <- as.data.frame(svytable(~main$impact2_3, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.impact2_3==1) %>% select(-Freq, -main.impact2_3)

knitr:: kable(I_2.3, 
      col.names = c("PoCs with access to health services"),
      align = "c",
      caption = "Table 2: Impact indicator 2.3 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

#kable_styling(table1, font_size = 12)

```

```{r i2.3 nat}
imp2_3 <- main %>% filter(!is.na(impact2_3))

imp2_3 <- (as.data.frame(wtd.table(imp2_3$impact2_3, imp2_3$REF02, 
                                   weights = imp2_3$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(imp2_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 2.3 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))


```

```{r i2.3 reg}
imp2_3 <- main %>% filter(!is.na(impact2_3))

imp2_3 <- (as.data.frame(wtd.table(imp2_3$impact2_3, imp2_3$region, 
                                   weights = imp2_3$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(imp2_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 2.3 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))


```

At the national level, 77.6% of households have _access to health services_. This question was only asked to the key informant of the household. 

In context, although the percentage looks well, the last years in Ecuador have implied a strong deterioration of public services, especially health services. 

```{r, include=FALSE}
# val_2.3 <- main %>% 
#   group_by(REF02) %>% 
#   mutate(Mean = mean(is.na(impact2_3))) %>% 
#   select(Mean, REF02)
# 
# val_2.3 <- aggregate(. ~ REF02, val_2.3, max)
# 
# val_2.3 <- subset(val_2.3, REF02!="Ecuatoriana" & REF02!="Otra")  
  
# ggplot(val_2.3, aes(reorder(REF02, -Mean), Mean)) +
#     geom_col(stat="identity", fill="#0072BC", alpha=.6, widht=.4) +
#     xlab("") + 
#     theme(panel.background = element_rect(fill="white"),
#           axis.text=element_text(size=14),
#         axis.title=element_text(size=14,face="bold"))


# ggplot(val_2.3, aes(REF02)) + 
#   geom_col(aes(y = Mean,
#                fill = Mean)) +
#   scale_color_manual(
#     values = c("Mean" = "#0072BC")
#   ) +
#   theme(legend.position = "none", panel.background = element_rect(fill="white"),
#           axis.text=element_text(size=14),
#         axis.title=element_text(size=14,face="bold"))

```


## <span style="color:#00B398">IMPACT AREA 3: EMPOWERING COMMUNITIES AND ACHIEVING GENDER EQUALITY</span>

### Impact indicator 3.2: Proportion of PoC enrolled in primary and secondary education

```{r i3.2a}
aux <- ind %>% filter(edu_enrollpri==1)
aux2 <- ind %>% filter(age_primary==1)

# aux <- ind %>% filter(!is.na(impact3_2a))
# svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

# I_3.2 <- as.data.frame(svytable(~aux$impact3_2a, design = svy.i2) %>% 
#           prop.table()) %>% 
#           mutate(Percent=100*Freq/sum(Freq)) %>% 
#           mutate(Percent=round(Percent, 1)) %>%  
#           filter(aux.impact3_2a==1) %>% select(-Freq, -aux.impact3_2a)

I_3.2 <- as.data.frame(sum(aux$w_roster)/sum(aux2$w_roster)) %>% 
  rename(Freq="sum(aux$w_roster)/sum(aux2$w_roster)") %>% 
  mutate(Percent=100*Freq) %>% 
  mutate(Percent=round(Percent, 1)) %>% select(-Freq)
  
knitr:: kable(I_3.2, 
      col.names = c("PoCs enrolled in primary education"),
      align = "c",
      caption = "Table 3: Impact indicator 3.2a (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

#kable_styling(table1, font_size = 12)

```

```{r i3.2a nat}
imp3_2 <- (as.data.frame(wtd.table(ind$age_impact3_2a, ind$REF02, 
                                   weights = ind$w_roster, useNA=("no")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% filter(Var2=="Colombiana" | Var2=="Venezolana")

ggplot(imp3_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 3.2a by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))


```

```{r i3.2a reg}
reg_ind <- main %>% select("_parent_index", "region")

ind <- merge(ind, reg_ind, by="_parent_index")

imp3_2 <- (as.data.frame(wtd.table(ind$impact3_2a, ind$region, 
                                   weights = ind$w_roster, useNA=("no")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1)

ggplot(imp3_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 3.2a by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))


```

At the national level, 68.3% of children are _enrolled in the primary education_ according to what was reported by the household informant. 

```{r i3.2b}
aux3 <- ind %>% filter(edu_enrollsec==1)
aux4 <- ind %>% filter(age_secondary==1)

# aux <- ind %>% filter(!is.na(impact3_2b))
# svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)
# 
# I_3.2 <- as.data.frame(svytable(~aux$impact3_2b, design = svy.i2) %>% 
#           prop.table()) %>% 
#           mutate(Percent=100*Freq/sum(Freq)) %>% 
#           mutate(Percent=round(Percent, 1)) %>%  
#           filter(aux.impact3_2b==1) %>% select(-Freq, -aux.impact3_2b)

I_3.2 <- as.data.frame(sum(aux3$w_roster)/sum(aux4$w_roster)) %>% 
  rename(Freq="sum(aux3$w_roster)/sum(aux4$w_roster)") %>% 
  mutate(Percent=100*Freq) %>% 
  mutate(Percent=round(Percent, 1)) %>% select(-Freq)

knitr:: kable(I_3.2, 
      col.names = c("PoCs enrolled in secondary education"),
      align = "c",
      caption = "Table 4: Impact indicator 3.2b (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

#kable_styling(table1, font_size = 12)

```

```{r i3.2b nat}
imp3_2 <- (as.data.frame(wtd.table(ind$impact3_2b, ind$REF02, 
                                   weights = ind$w_roster, useNA=("no")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% filter(Var2=="Colombiana" | Var2=="Venezolana")

ggplot(imp3_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 3.2b by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))


```

```{r i3.2b reg}
#reg_ind <- main %>% select("_parent_index", "region")

#ind <- merge(ind, reg_ind, by="_parent_index")

imp3_2 <- (as.data.frame(wtd.table(ind$impact3_2b, ind$region, 
                                   weights = ind$w_roster, useNA=("no")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1)

ggplot(imp3_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 3.2b by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))


```

At the national level, 45.9% of teenagers are _enrolled in the secondary education_ according to what was reported by the household informant.

In context, in Ecuador the levels of education system are ordered in basic education (10 years) and high-school (3 years). In this sense, generally basic education covers children between 5 and 11-12 years old, and high school -called _bachillerato_ in Ecuador- covers teenagers between 12 to 17-18 years old.

Also, in absolute values, we can show the official statistics provided by Ministry of Education. For the academic year 2022-23, more than 55k Venezuelan children are enrolled in the education system (we are not considering Colombian children because not all of them are PoC for UNHCR). 

```{r mineduc}
Mineduc <- c("2021-22", "2022-23")
Vmineduc <- c(60146, 55759)

ed_figs <- data.frame(Mineduc, Vmineduc)

kable(ed_figs, 
      col.names = c("Academic year", "Number of students"),
      align = "cc",
      caption = "Table 5: Venezuelan students enrolled in national 
      education system (Primary + Secondary level)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```


### Impact indicator 3.3: Proportion of PoC feeling safe walking alone in their neighborhood

```{r i3.3}
I_3.3 <- as.data.frame(svytable(~main$impact3_3, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.impact3_3==1) %>% select(-Freq, -main.impact3_3)

knitr:: kable(I_3.3, 
      col.names = c("PoCs feeling safe walking alone in 
                    their neighborhood"),
      align = "c",
      caption = "Table 6: Impact indicator 3.3 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

This indicator addresses the perception of security that PoC have in their neighborhoods. At the national level, **33.3%** of people surveyed perceive that can walk alone in their area. This low result is explained easily given the insecurity that hits the country since various months ago. In the discussions with PoC in some provinces, they are mentioning their feeling of risk and vulnerability due to the presence of criminal groups.

```{r i3.3 nat}
imp3_3 <- (as.data.frame(wtd.table(main$impact3_3, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(imp3_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 3.3 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

And, as we expected, if we see the indicator across nationalities, we can find that Venezuelan people feel more secure in their areas of residence. However, Colombian people are different because they react easily to insecurity given the context of violence from which they have fled.

```{r i3.3 reg}
imp3_3 <- (as.data.frame(wtd.table(main$impact3_3, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(imp3_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Impact indicator 3.3 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

```{r remove 1}
rm(aux, ed_figs, I_2.2, I_2.3, I_3.2, I_3.3, imp2_2, imp2_3, imp3_2, imp3_3, Mineduc, Vmineduc, aux2, aux3, aux4)
```


## <span style="color:#00B398">OUTCOME AREA 1: ACCESS TO TERRITORY, REGISTRATION AND DOCUMENTATION</span>

### Outcome indicator 1.2: Proportion of children under 5 years of age whose births have been registered with a civil authority

```{r o1.2}
O_1.2 <- as.data.frame(svytable(~ind$outcome1_2, design = svy.ind) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(ind.outcome1_2==1) %>% select(-Freq, -ind.outcome1_2)

knitr:: kable(O_1.2, 
      col.names = c("CHildren under 5 years whose births have been 
                    registered with a civil authority"),
      align = "c",
      caption = "Table 7: Outcome indicator 1.2 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o1.2 nat}
aux <- ind %>% filter(!is.na(outcome1_2))
svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

out1_2 <- (as.data.frame(wtd.table(aux$outcome1_2, aux$REF02, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% filter(Var2=="Colombiana" | Var2=="Venezolana")

ggplot(out1_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 1.2 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o1.2 reg}
out1_2 <- (as.data.frame(wtd.table(aux$outcome1_2, aux$region, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out1_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 1.2 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 97.3% of new born are _registered with a civil authority_ according to what was reported by the household informant.

Regards this outcome indicator, we have a change in its calculation. In Ecuador, gynecologists working in public hospitals have the obligation to record each new born in the system called _REVIT_ (Sistema Nacional de Registro de Datos Vitales, by its acronym in Spanish). This system allows to register each baby in the Civil Registry database, whose information is also stored in the Vital Statistics Report produced by INEC (National Statistic Office in Ecuador). For this reason, when a birth is certified, is also registered by local authorities. 

This process, nonetheless, have two possible problems to work perfectly. First, in private hospitals the doctors should be used REVIT, but it is not compulsory. So, a number of births will be registered by parents in the office of Civil Registry, either over the counter or online. But, the PoC are using almost entirely, the public health services according to our Protection Monitoring of 2021 and 2022. Second, in rural areas there are still non-institutionalized births. So, it could lead to a non-certified and non-registered new born. But, the PoC are living mostly in urban areas, therefore the second problem is not contradictory to the main assumption.

In sum, we are using the question about birth certificate to compute the outcome indicator 1.2. And, this indicator has been fulfilled in Ecuador given the current parameters of the RMS: sampling strategy, phone survey, and contactability within the database of proGres V4.


### Outcome indicator 1.3: Proportion of PoC with legally recognized identity documents or credentials 

Here, it is need to mention that we are considering as _valid_ document only ID and passport that are valid, i.e. are not expired or lost. And, other available documents just in case of PoC has not anyone of the list provided in the questionnaire.

```{r o1.3}
aux <- ind %>% filter(!is.na(outcome1_3))
svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

O_1.3 <- as.data.frame(svytable(~aux$outcome1_3, design = svy.i2) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(aux.outcome1_3==1) %>% select(-Freq, -aux.outcome1_3)

knitr:: kable(O_1.3, 
      col.names = c("PoC with legally recognized identity 
                    documents or credentials"),
      align = "c",
      caption = "Table 8: Outcome indicator 1.3 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)
```

```{r o1.3 nat}
aux <- ind %>% filter(!is.na(outcome1_3))
svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

out1_3 <- (as.data.frame(wtd.table(aux$outcome1_3, aux$REF02, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% filter(Var2=="Colombiana" | Var2=="Venezolana")

ggplot(out1_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 1.3 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o1.3 reg}
out1_3 <- (as.data.frame(wtd.table(aux$outcome1_3, aux$region, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out1_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 1.3 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 89.9% of PoC have _valid identity documents_ according to what was reported by the household informant regards each household member.


## <span style="color:#00B398">OUTCOME AREA 4: GENDER-BASED VIOLENCE</span>

### Outcome indicator 4.1: Proportion of PoC who know where to access available SGBV services.

One key dimension where UNHCR works is in the provision of services to survivors of Gender-based violence (GBV). But, have this services available in the field does not represents the end of the intervention. It is also need to spread the information about where those services are located, and then providing a satisfactory attention and support throughout the process.

About the last element, the Operation in Ecuador is using information collected by its national partner HIAS. About the former, we obtain the next results with the RMS. This indicator counts if, anyone of the services enlisted, are known by the population and know where to find them. The services includes: 

- Health services
- Psycho-social services
- Safety and security services
- Legal assistance

```{r o4.1}
O4_1 <- as.data.frame(svytable(~main$outcome4_1, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome4_1==1) %>% select(-Freq, -main.outcome4_1)

knitr:: kable(O4_1, 
      col.names = c("PoC who know where to access 
                    available SGBV services"),
      align = "c",
      caption = "Table 9: Outcome indicator 4.1 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o4.1 reg}
out4_1 <- (as.data.frame(wtd.table(main$outcome4_1, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out4_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 4.1 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o4.1 nat}
out4_1 <- (as.data.frame(wtd.table(main$outcome4_1, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out4_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 4.1 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 74.7% of PoC know about _available SGBV services_. But, it also maybe shows a misunderstood of the question between the sample, a key fact to discuss previously of new waves of RMS collection.


### Outcome indicator 4.2: Proportion of PoC who do not accept violence against women

This measure could be one of the most _controversial_ within the RBM core indicators. Here, to identify the people that do not accept violence against women must be used five questions that recreate everyday situations and then, the informant must indicate whether it is acceptable or not that the husband hits his wife in such a situation.

Also, the opening question of this section asks whether the respondent feels comfortable talking about domestic violence. If so, he/she answers about the violent situations. Thus, a first finding regards that an important portion of the sample preferred not to talk about domestic violence (27%). It is possible that the people who did not want to answer is unaware of this problem or were in a risky position to answer it by phone.

```{r o4.2}
O_4.2 <- as.data.frame(svytable(~main$outcome4_2, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome4_2==0) %>% select(-Freq, -main.outcome4_2)

knitr:: kable(O_4.2, 
      col.names = c("PoC who do not accept violence 
                    against women"),
      align = "c",
      caption = "Table 10: Outcome indicator 4.2 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o4.2 nat}
aux <- main %>% filter(!is.na(outcome4_2))
svy.m2 <- svydesign(ids=~1, data=aux, weights=aux$weights)

out4_2 <- (as.data.frame(wtd.table(aux$outcome4_2, aux$REF02, 
                                   weights = aux$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==0) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out4_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 4.2 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o4.2 reg}
out4_2 <- (as.data.frame(wtd.table(aux$outcome4_2, aux$region, 
                                   weights = aux$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==0) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out4_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 4.2 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

```{r}
# main$gbv_screen <- factor(main$gbv_screen, 
#                     levels= c(0,1), 
#                     labels = c("No","Yes"))
# 
# perc_screen <- as.data.frame(prop.table(table(main$gbv_screen, main$HH04), margin=2))
# perc_screen <- subset(perc_screen, Var2!="Other" & Var2!="Prefers not to say")
# perc_screen <- perc_screen %>% mutate(Freq = Freq*100)
# 
# perc_screenw <- spread(perc_screen, key = Var2, value = Freq)
# 
# kable(perc_screenw, 
#       col.names = c("Response", "Sex", "Percentage"),
#       align = "cc",
#       caption = "Table 6: Results of GBV screen",
#       digits=2) %>% 
#   kable_classic_2(full_width=FALSE)
```

At the national level, 98.9% of informants that answered the particular set of questions for this indicator _do not accept the violence against women_. These results are surprising because despite of the work led by UNHCR and other organizations, this problem is worrying in Ecuador. That is to say, not all of the sampling people may be well-informed and aware of violence against women. 

In this line, a first suggestion is to count the people who do not feel comfortable talking about domestic violence plus those that accept any kind of aggression against women. And then, to review the approach of the indicator because is not probable that people to accept, through phone or in-person, that some situations would lead to aggression against women.


## <span style="color:#00B398">OUTCOME AREA 5: CHILD PROTECTION</span>

### Outcome indicator 5.2: Proportion of children who participate in community-based child protection programmes

The indicator counts children who attended community activities at least 2 times, under adult supervision in a physically safe area. These activities include playing in the park, being part of a sport team or other where can relate to other children both on human mobility and from the host community.

```{r o5.2}
aux <- ind %>% filter(!is.na(outcome5_2))
svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

O_5.2 <- as.data.frame(svytable(~aux$outcome5_2, design = svy.i2) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(aux.outcome5_2==1) %>% select(-Freq, -aux.outcome5_2)

knitr:: kable(O_5.2, 
      col.names = c("Children who participate in community-based 
                    child protection programmes"),
      align = "c",
      caption = "Table 11: Outcome indicator 5.2 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o5.2 nat}
aux <- ind %>% filter(!is.na(outcome5_2))
svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

out5_2 <- (as.data.frame(wtd.table(aux$outcome5_2, aux$REF02, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% filter(Var2=="Colombiana" | Var2=="Venezolana")

ggplot(out5_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 5.2 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o5.2 reg}
out5_2 <- (as.data.frame(wtd.table(aux$outcome5_2, aux$region, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out5_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 5.2 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 4.6% of informants mentioned that _children participate in community-based child protection programmes_. The low value obtaines arises a concern about the non-satisfied need of implement _physical_ community spaces oriented to child integration.


## <span style="color:#00B398">OUTCOME AREA 8: WELL-BEING AND BASIC NEEDS</span>

### Outcome indicator 8.2: Proportion of PoC with primary reliance on clean (cooking) fuels and technology

This indicator measures the use of clean cooking fuels and its related devices in the household. 

```{r o8.2}
O_8.2 <- as.data.frame(svytable(~main$outcome8_2, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome8_2==1) %>% select(-Freq, -main.outcome8_2)

knitr:: kable(O_8.2, 
      col.names = c("PoC with primary reliance on clean 
                    (cooking) fuels and technology"),
      align = "c",
      caption = "Table 12: Outcome indicator 8.2 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)


```

```{r o8.2 nat}
out8_2 <- (as.data.frame(wtd.table(main$outcome8_2, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out8_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 8.2 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o8.2 reg}
out8_2 <- (as.data.frame(wtd.table(main$outcome8_2, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out8_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 8.2 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

Considering that the great majority of respondents indicate that they are _cooking with domestic gas or electricity through a kitchen or stoves_, the national value of the indicator is high: 99.4%.


## <span style="color:#00B398">OUTCOME AREA 10: HEALTHY LIVES</span>

### Outcome indicator 10.1: Proportion of children aged 9 months to five years who have received measles vaccination

This indicator measures the proportion of children who had at least one dose of measles vaccination.

```{r o10.1}
aux <- ind %>% filter(!is.na(outcome10_1))
svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

O_10.1 <- as.data.frame(svytable(~aux$outcome10_1, design = svy.i2) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(aux.outcome10_1==1) %>% select(-Freq, -aux.outcome10_1)

knitr:: kable(O_10.1, 
      col.names = c("Children aged 9 months to five years who have received measles vaccination"),
      align = "c",
      caption = "Table 13: Outcome indicator 10.1 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)
```

```{r o10.1 nat}
aux <- ind %>% filter(!is.na(outcome10_1))
svy.i2 <- svydesign(ids=~1, data=aux, weights=aux$w_roster)

out10_1 <- (as.data.frame(wtd.table(aux$outcome10_1, aux$REF02, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% filter(Var2=="Colombiana" | Var2=="Venezolana")

ggplot(out10_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 10.1 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o10.1 reg}
out10_1 <- (as.data.frame(wtd.table(aux$outcome10_1, aux$region, 
                                   weights = aux$w_roster, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out10_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 10.1 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 82.8% of informants mentioned that _children aged 9 months to five years have received measles vaccination_.


### Outcome indicator 10.2: Proportion of births attended by skilled health personnel

This indicator measures when there are live births in the last 2 years, and whether the births were attended by doctors, nurses, and other medical staff. 

```{r o10.2}
O_10.2 <- as.data.frame(svytable(~main$outcome10_2, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome10_2==1) %>% select(-Freq, -main.outcome10_2)

knitr:: kable(O_10.2, 
      col.names = c("Births attended by skilled 
                    health personnel"),
      align = "c",
      caption = "Table 14: Outcome indicator 10.2 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)


```

```{r o10.2 nat}
aux <- main %>% filter(!is.na(outcome10_2))
svy.m2 <- svydesign(ids=~1, data=aux, weights=aux$weights)

out10_2 <- (as.data.frame(wtd.table(aux$outcome10_2, aux$REF02,
                                    weights = aux$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out10_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 10.2 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o10.2 reg}
out10_2 <- (as.data.frame(wtd.table(aux$outcome10_2, aux$region, 
                                   weights = aux$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out10_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 10.2 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 97.4% of informants answered that in the last 2 years, births in their households were _attended by skilled health personnel_.


## <span style="color:#00B398">OUTCOME AREA 13: SELF RELIANCE, ECONOMIC INCLUSION AND LIVELIHOODS</span>

### Outcome indicator 13.1: Proportion of PoC with an account at a bank or other financial institution or with a mobile-money service provider

The indicator includes if the respondent has an account on their own/with someone else, ATM card, personal bank card or personally used phone to send money in the country of asylum.

```{r o13.1}
O_13.1 <- as.data.frame(svytable(~main$outcome13_1, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome13_1==1) %>% select(-Freq, -main.outcome13_1)

knitr:: kable(O_13.1, 
      col.names = c("PoC with an account at a bank or other 
                    financial institution or with a 
                    mobile-money service provider"),
      align = "c",
      caption = "Table 15: Outcome indicator 13.1 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o13.1 nat}
out13_1 <- (as.data.frame(wtd.table(main$outcome13_1, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out13_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 13.1 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o13.1 reg}
out13_1 <- (as.data.frame(wtd.table(main$outcome13_1, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out13_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 13.1 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 15.8% of households _have a personal bank account or use other financial services_ in the country of asylum.


### Outcome indicator 13.2: Proportion of PoC who self-report positive changes in their income compared to previous year.

The indicator counts only the individuals that reported they can afford 'more' goods and services regards to the last year.

```{r o13.2}
O_13.2 <- as.data.frame(svytable(~main$outcome13_2, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome13_2==1) %>% select(-Freq, -main.outcome13_2)

knitr:: kable(O_13.2, 
      col.names = c("PoC who self-report positive changes in
                    their income compared to previous year"),
      align = "c",
      caption = "Table 16: Outcome indicator 13.2 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o13.2 nat}
out13_2 <- (as.data.frame(wtd.table(main$outcome13_2, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out13_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 13.2 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o13.2 reg}
out13_2 <- (as.data.frame(wtd.table(main$outcome13_2, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out13_2, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 13.2 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level, 14.1% of households _self-report positive changes in their income compared to previous year_ in the country of asylum.


### Outcome indicator 13.3: Proportion of PoC (working age) who are unemployed

The indicator reflects the rate of unemployment between PoC with 15 years or more.

To calculate the rate, the numerator includes those of working age who were not in employment, looked for employment in the past 30 days and were available to take up employment in the next 14 days. The denominator includes those of working age in the labor force.

```{r o13.3}
O_13.3 <- as.data.frame(svytable(~main$outcome13_3, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome13_3==1) %>% select(-Freq, -main.outcome13_3)

knitr:: kable(O_13.3, 
      col.names = c("PoC in the working age who are 
                    unemployed"),
      align = "c",
      caption = "Table 17: Outcome indicator 13.3 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o13.3 nat}
out13_3 <- (as.data.frame(wtd.table(main$outcome13_3, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out13_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 13.3 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o13.3 reg}
out13_3 <- (as.data.frame(wtd.table(main$outcome13_3, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out13_3, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 13.3 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level between the people that UNHCR serves, 9.8% _are unemployed_ in Ecuador. This value is greater than double the average Ecuadorian rate that is 3.8% for the fourth quarter of 2022, according to INEC. For this reason, it is important to contextualize the indicator because in Ecuador, both for nationals and for refugees, the main problem is the condition of employment: precariousness, instability, and low wages.

```{r informal employment nat}
main <- main %>% 
  mutate(informal = case_when(
    MDV01==1   & employed==1 ~ "Formal",
    
    MDV02==1   & ((UNEM07_num==3) | ((UNEM07_num==1 | UNEM07_num==2) & (UNEM08_num==1 | UNEM08_num==2))) & employed==1 ~ "Formal",
    
    MDV01_2==1 & employed==1 ~ "Formal",
    
    MDV02_2==1 & ((UNEM06_num==3) | ((UNEM06_num==1 | UNEM06_num==2) & (UNEM08_num==1 | UNEM08_num==2))) & employed==1 ~ "Formal",
    
    UNEM03==1  & (UNEM08_num==1 | UNEM08_num==2) & employed==1 ~ "Formal",
    
    MDV01==0   | MDV01==98   & employed==1 ~ "Informal",
    
    MDV02==0   | MDV02==98   & ((UNEM07_num==3) | ((UNEM07_num==1 | UNEM07_num==2) & (UNEM08_num==1 | UNEM08_num==2))) & employed==1 ~ "Informal",
    
    MDV01_2==0 | MDV01_2==98 & employed==1 ~ "Informal",
    
    MDV02_2==0 | MDV02_2==98 & ((UNEM06_num==3) | ((UNEM06_num==1 | UNEM06_num==2) & (UNEM08_num==1 | UNEM08_num==2))) & employed==1 ~ "Informal",
    
    TRUE ~ as.character(NA)))

main <- main %>% mutate(informal = ifelse(HH07<15,NA_character_,informal))

informal1 <- (as.data.frame(wtd.table(main$informal, main$REF02, weights=main$weights))) %>%
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          rename("Type" = Var1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(informal1, aes(x=Var2, y=Percent, fill=Type)) +
  geom_bar(position = "dodge", stat="identity", alpha=.6, width=.6) +
  geom_text(aes(label=Percent), position = position_dodge(width = 0.6),
            vjust=0.25, size=4) +
  ggtitle("Formal and informal employment by nationality (%)") +
  theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
        axis.text.y = element_blank(),
        axis.title=element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face="bold", size=12, hjust=0.5)) + 
scale_fill_manual(values=c("#0072BC", "#00B398"))

```

```{r informal employment reg}
informal1 <- (as.data.frame(wtd.table(main$informal, main$region, weights=main$weights))) %>%
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          rename("Type" = Var1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(informal1, aes(x=Var2, y=Percent, fill=Type)) +
  geom_bar(position = "dodge", stat="identity", alpha=.6, width=.6) +
  geom_text(aes(label=Percent), position = position_dodge(width = 0.6),
            vjust=0.25, size=4) +
  ggtitle("Formal and informal employment by region (%)") +
  theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
        axis.text.y = element_blank(),
        axis.title=element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face="bold", size=12, hjust=0.5)) + 
scale_fill_manual(values=c("#18375F", "#8395B9"))

```


## <span style="color:#00B398">OUTCOME AREA 16: LOCAL INTEGRATION AND OTHER LOCAL SOLUTIONS</span>

### Outcome indicator 16.1: Proportion of PoC with secure tenure rights and/or property rights to housing and/or land

The indicator aims to measure the security of the household to keep legally their house. It includes the conditions:
- losing the right to housing is unlikely
- have official documents to prove residency
- own the house or field

In the Ecuadorian case, official documents are only property rights or written contracts, and only owning a house or land.

```{r o16.1}
O_16.1 <- as.data.frame(svytable(~main$outcome16_1, design = svy.dat) %>% 
          prop.table()) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>%  
          filter(main.outcome16_1==1) %>% select(-Freq, -main.outcome16_1)

knitr:: kable(O_16.1, 
      col.names = c("PoC with secure tenure rights and/or 
                    property rights to housing and/or land"),
      align = "c",
      caption = "Table 18: Outcome indicator 16.1 (%)") %>% 
  kable_classic_2(full_width=FALSE, font_size=18)

```

```{r o16.1 nat}
out16_1 <- (as.data.frame(wtd.table(main$outcome16_1, main$REF02, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="Colombian",
                                     "2"="Venezuelan"))

ggplot(out16_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 16.1 by nationality (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#0072BC", "#00B398"))

```

```{r o16.1 reg}
out16_1 <- (as.data.frame(wtd.table(main$outcome16_1, main$region, 
                                   weights = main$weights, useNA=("ifany")))) %>% 
          group_by(Var2) %>% 
          mutate(Percent=100*Freq/sum(Freq)) %>% 
          mutate(Percent=round(Percent, 1)) %>% 
          filter(Var1==1) %>% 
          mutate(Var2 = recode(Var2, "1"="North",
                                     "2"="Center",
                                     "3"="South"))

ggplot(out16_1, aes(x=Var2, y=Percent, fill=Var2)) +
    geom_bar(position="dodge", stat="identity", alpha=.6, width=.4) +
    geom_text(aes(label = Percent), position = position_dodge(width = 0.9), 
              vjust = 0.25, size=4) +
    ggtitle("Outcome indicator 16.1 by region (%)") +
    theme(panel.background = element_rect(fill="white"),
          axis.text.x=element_text(size=12),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          axis.title=element_blank(),
          legend.position = "none",
          plot.title = element_text(face= "bold", size=12, hjust=0.5)) +
          scale_fill_manual(values = c("#18375F", "#506489", "#8395B9"))

```

At the national level of the people that UNHCR serves, 34.7% _have secure tenure of their house_ in Ecuador.

```{r remove 2}
rm(aux, informal1, O_1.2, O_1.3, O_10.1, O_10.2, O_13.1, O_13.2, O_13.3, O_16.1, O_4.2, O_5.2, O_8.2, O4_1, out1_2, out1_3, out10_1, out10_2, out13_1, out13_2, out13_3, out16_1, out4_1, out4_2, out5_2, out8_2, svy.i2, svy.m2)
```

